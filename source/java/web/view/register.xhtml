<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:rich="http://richfaces.org/rich"
                xmlns:a4j="http://richfaces.org/a4j"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                template="../templates/userTemplate1.xhtml"
        >
    <ui:define name="content">
    <c:if test = "#{sessionBean.uLogin}">
        Ви вже зареєстровані
    </c:if>
    <c:if test = "#{!sessionBean.uLogin}">
        <h:outputScript library="javascript" name="sha1.js" target="head"/>
        <script type="text/javascript">
            function hash_pass_reg() {

                if (document.getElementById('r_password').value == "" || document.getElementById('r_passwordrepeat').value == "" ||
                    document.getElementById('r_username').value == "" || document.getElementById('r_userpib').value == "")  {
                    document.getElementById('mes_empty').innerHTML = "Заповніть всі поля";
                    return false;
                }
                if (document.getElementById('r_password').value != document.getElementById('r_passwordrepeat').value){
                    document.getElementById('mes_empty').innerHTML = "Паролі не співпадають";
                    return false;
                }

                document.getElementById('formr:r_hashpass').value = hex_sha1(document.getElementById('r_username').value+document.getElementById('r_password').value);
                if (document.getElementById('r_password').value != "") {document.getElementById('r_password').value = "usernamepass";}
            }
        </script>
        <h:outputLink value="../index.xhtml" styleClass="ui-commandlink">Передумав реєструватися</h:outputLink>
        <h2>Form Register New User</h2>


            <h:panelGrid columns="3">

                <h:outputLabel value="Логін: " />
                <h:inputText id="r_username" onblur="document.getElementById('mes_empty').innerHTML = '';validusername(this.value)" value="#{registrationNewUser.userName}" required="true" requiredMessage="Не вказано!"/>
                <rich:message id="r_mes_username" for="r_username" />


                <h:outputLabel value="Пароль: " />
                <h:inputSecret id="r_password" value="#{registrationNewUser.userPass}" required="true" requiredMessage="Не вказано!" />
                <rich:message id = "r_mes_password" for="r_password"/>

                <h:outputLabel value="Підтвердити пароль: " />
                <h:inputSecret id="r_passwordrepeat" value="#{registrationNewUser.userPassRepeat}" required="true" requiredMessage="Не вказано!"/>
                <rich:message id = "r_mes_passwordrepeat" for="r_passwordrepeat"/>

                <h:outputLabel value="Ім'я та Прізвище: " />
                <h:inputText id="r_userpib" onblur="validpib(this.value)" value="#{registrationNewUser.userPIB}" required="true" requiredMessage="Не вказано!"/>
                <rich:message id="r_mes_userpib" for="r_userpib" />

                <h:outputLabel value="Електрона адреса: " />
                <h:inputText id="r_useremail" onblur="validemail(this.value)" value="#{registrationNewUser.userEMail}" required="true" requiredMessage="Не вказано!"/>
                <rich:message id="r_mes_useremail" for="r_useremail" />

                <h:outputLabel value="Стать: " />
                <rich:inplaceSelect id="r_sex" saveOnSelect="true" defaultLabel="Click here to edit" openOnEdit="true" value="#{registrationNewUser.sex}"
                                    onblur="validsex( #{rich:component('r_sex')}.getValue() )">
                    <f:selectItem itemValue="M" itemLabel="Чол"/>
                    <f:selectItem itemValue="W" itemLabel="Жін"/>
                </rich:inplaceSelect>
                <rich:message id="r_mes_sex" for="r_sex"/>

                <h:outputLabel value="Мова: " />
                <rich:inplaceSelect id = "r_userlang" saveOnSelect="true" defaultLabel="Click here to edit" openOnEdit="true" value="#{registrationNewUser.userLang}"
                                    onblur="validlang( #{rich:component('r_userlang')}.getValue() )">
                    <f:selectItems value="#{sessionBean.langs}"/>
                </rich:inplaceSelect>


            </h:panelGrid>
        <p:growl id="msgreg" showSummary="true" showDetail="true" globalOnly="true" life="6000" />

        <h:form id="formr" onsubmit="return hash_pass_reg()">
            <h:commandLink value="Registration" action="#{registrationNewUser.registr}" update="msgreg" ajax="false" styleClass="ui-commandlink"/>
            <h:inputHidden id="r_hashpass" value="#{registrationNewUser.hashPass}"/>
        </h:form>
        <p:messages globalOnly="true"/>
        <h:outputLabel id="mes_empty" styleClass="rf-msg-err" value=""/>


        <h:form id="t1">
            <a4j:jsFunction name="validemail"  action = "#{registrationNewUser.validUserEMailAjax}" limitRender="true" render="r_mes_useremail">
                <a4j:param name="p1" assignTo="#{registrationNewUser.userEMail}" />
            </a4j:jsFunction>
        </h:form>
        <h:form id="t2">
            <a4j:jsFunction name="validusername"  action = "#{registrationNewUser.validUserNameAjax}"  limitRender="true" render="r_mes_username">
                <a4j:param name="p1" assignTo="#{registrationNewUser.userName}" />
            </a4j:jsFunction>
        </h:form>
        <h:form id="t3">
            <a4j:jsFunction name="validpib"  action = "#{registrationNewUser.validUserPIBAjax}"  limitRender="true" render="r_mes_userpib">
                <a4j:param name="p1" assignTo="#{registrationNewUser.userPIB}" />
            </a4j:jsFunction>
        </h:form>
        <h:form id="t4">
            <a4j:jsFunction name="validsex"  action = "#{registrationNewUser.validSexAjax}"  limitRender="true"
                            render="r_mes_sex">
                <a4j:param name="p1" assignTo="#{registrationNewUser.sex}" />
            </a4j:jsFunction>
        </h:form>
        <h:form id="t5">
            <a4j:jsFunction name="validlang"  limitRender="true">
                <a4j:param name="p1" assignTo="#{registrationNewUser.userLang}" />
            </a4j:jsFunction>
        </h:form>
    </c:if>
    </ui:define>

</ui:composition>
